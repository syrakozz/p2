# ARGS
ARG DIS_ENV
ARG DIS_BUILD_IMAGE
ARG DIS_BUILD_COMMIT
ARG DIS_BUILD_DATETIME
ARG DIS_BUILD_TAG

# BUILDER
FROM golang:1.21-alpine as builder

WORKDIR /go/delivery
COPY . .

RUN CGO_ENABLED=0 go build -ldflags "-s -w" disruptive/cmd/mondayd

# SERVICE
FROM alpine:latest

RUN apk add --no-cache ca-certificates 

ARG DIS_ENV
ARG DIS_BUILD_IMAGE
ARG DIS_BUILD_COMMIT
ARG DIS_BUILD_DATETIME
ARG DIS_BUILD_TAG

ENV DIS_ENV=$DIS_ENV
ENV DIS_BUILD_IMAGE=$DIS_BUILD_IMAGE
ENV DIS_BUILD_COMMIT=$DIS_BUILD_COMMIT
ENV DIS_BUILD_DATETIME=$DIS_BUILD_DATETIME
ENV DIS_BUILD_TAG=$DIS_BUILD_TAG

WORKDIR /root
COPY --from=builder /go/delivery/mondayd .

CMD ["./mondayd"]
